---
import { updateProductField } from "../../../../lib/store";
import { parseApiParams, getTableData } from "../../../../lib/api-utils";
import ApiResponse from "../../../../components/ApiResponse.astro";

const id = Number(Astro.params.id);
const formData = await Astro.request.formData();
const qty = Number(formData.get("quantity"));

try {
  updateProductField(id, "quantity", qty);
} catch (e) {
  return new Response("Error updating product", { status: 500 });
}

const params = parseApiParams(Astro.request);
const { data, total, totals } = getTableData(params);

// Set response headers for HTMX
Astro.response.headers.set("Content-Type", "text/html");
---

<ApiResponse 
  data={data}
  total={total}
  totals={totals}
  page={params.page}
  pageSize={params.pageSize}
  sort={params.sort}
  sortDir={params.sortDir}
  searchTerm={params.searchTerm}
/>