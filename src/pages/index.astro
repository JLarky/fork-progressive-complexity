---
import Layout from "../layouts/Layout.astro";
import SummaryHeader from "../components/SummaryHeader.astro";
import HomePageTable from "../components/HomePageTable.astro";
import { parseApiParams, getTableData } from "../lib/api-utils";

const params = parseApiParams(Astro.request);
const { data, total, totals } = getTableData(params);
---

<script>
  import "../components/web-components/TableHeader.ts";
  import "../lib/page-utils.ts";
</script>

<Layout>
  <div class="space-y-4">
    <SummaryHeader 
      totals={totals}
      page={params.page}
      pageSize={params.pageSize}
      sort={params.sort}
      sortDir={params.sortDir}
      searchTerm={params.searchTerm}
    />

    <HomePageTable 
      data={data}
      total={total}
      page={params.page}
      pageSize={params.pageSize}
      sort={params.sort}
      sortDir={params.sortDir}
      searchTerm={params.searchTerm}
    />
  </div>
</Layout>
